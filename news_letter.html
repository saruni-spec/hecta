<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="theme-color" content="#3ed2a7" />

    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="./favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="./favicon-16x16.png"
    />

    <title>Hecta Consulting | Blog</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800&display=swap"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      href="assets/vendors/liquid-icon/liquid-icon.min.css"
    />
    <link
      rel="stylesheet"
      href="assets/vendors/font-awesome/css/font-awesome.min.css"
    />
    <link rel="stylesheet" href="assets/css/theme-vendors.min.css" />
    <link rel="stylesheet" href="assets/css/theme_.css" />
    <link rel="stylesheet" href="assets/css/hecta.css" />
    <script async src="assets/vendors/modernizr.min.js"></script>

    <style>
      body.single-post-visible .posts-list-view {
        display: none;
      }
      body:not(.single-post-visible) .single-post-view {
        display: none;
      }
      .single-post-content {
        padding-top: 50px;
        padding-bottom: 50px;
      }
      .post-navigation {
        display: flex;
        justify-content: space-between;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid #e9e9e9;
      }

      .post-full-content p,
      .post-full-content li {
        font-size: 18px;
        line-height: 1.6;
      }
    </style>

    <style>
      .skeleton-card {
        background-color: #f5f5f7; /* Corresponds to your site's bg-athens-gray */
        border-radius: 12px;
        padding: 25px;
        height: 100%;
        position: relative;
        overflow: hidden;
      }
      .skeleton-line {
        background-color: #e9e9e9;
        border-radius: 4px;
        margin-bottom: 12px;
      }
      .skeleton-line.date {
        height: 14px;
        width: 35%;
        margin-bottom: 20px;
      }
      .skeleton-line.title {
        height: 24px;
        width: 75%;
      }
      .skeleton-line.text {
        height: 16px;
        width: 100%;
      }
      .skeleton-line.text-short {
        width: 85%;
      }
      .skeleton-line.button {
        height: 32px;
        width: 110px;
        border-radius: 99px; /* Corresponds to 'round' class */
        margin-top: 25px;
      }
      /* Shimmer animation */
      .skeleton-card::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0%,
          rgba(255, 255, 255, 0.5) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        animation: shimmer 1.5s infinite;
      }
      @keyframes shimmer {
        100% {
          transform: translateX(100%);
        }
      }
    </style>
  </head>
  <body
    data-mobile-nav-trigger-alignment="right"
    data-mobile-nav-align="center"
    data-mobile-nav-style="minimal"
    data-mobile-nav-scheme="gray"
    data-mobile-header-scheme="gray"
    data-mobile-nav-breakpoint="1199"
  >
    <div id="wrap">
      <header
        class="main-header main-header-overlay"
        data-sticky-header="true"
        data-sticky-options='{ "stickyTrigger": "first-section" }'
      >
        <div class="secondarybar-wrap">
          <div class="container secondarybar-container">
            <div class="secondarybar">
              <div class="row secondarybar-row align-items-center">
                <div class="col">&nbsp;</div>
              </div>
            </div>
          </div>
        </div>
        <div class="mainbar-wrap">
          <div class="container-fluid mainbar-container">
            <div class="mainbar">
              <div class="row mainbar-row align-items-lg-stretch px-4">
                <div class="col">
                  <div class="navbar-header">
                    <a class="navbar-brand" href="index.html" rel="home">
                      <span class="navbar-brand-inner">
                        <img
                          class="logo-dark"
                          src="./assets/images/logo-dark.svg"
                          alt="Hecta Consulting Logo"
                        />
                        <img
                          class="logo-sticky"
                          src="./assets/images/icon.svg"
                          alt="Hecta Consulting Logo"
                        />
                        <img
                          class="mobile-logo-default"
                          src="./assets/images/logo-dark.svg"
                          alt="Hecta Consulting Logo"
                        />
                        <img
                          class="logo-default"
                          src="./assets/images/logo.svg"
                          alt="Hecta Consulting Logo"
                        />
                      </span>
                    </a>
                    <button
                      type="button"
                      class="navbar-toggle collapsed nav-trigger style-mobile"
                      data-toggle="collapse"
                      data-target="#main-header-collapse"
                      aria-expanded="false"
                      data-changeclassnames='{ "html": "mobile-nav-activated overflow-hidden" }'
                    >
                      <span class="sr-only">Toggle navigation</span>
                      <span class="bars">
                        <span class="bar"></span>
                        <span class="bar"></span>
                        <span class="bar"></span>
                      </span>
                    </button>
                  </div>
                </div>
                <div class="col">
                  <div
                    class="collapse navbar-collapse"
                    id="main-header-collapse"
                  >
                    <ul
                      id="primary-nav"
                      class="main-nav nav align-items-md-stretch justify-content-lg-end"
                      data-submenu-options='{ "toggleType":"fade", "handler":"mouse-in-out" }'
                    >
                      <li>
                        <a href="index.html">
                          <span class="link-icon"></span>
                          <span class="link-txt">
                            <span class="link-ext"></span>
                            <span class="txt">Home</span>
                          </span>
                        </a>
                      </li>

                      <li>
                        <a href="about.html">
                          <span class="link-icon"></span>
                          <span class="link-txt">
                            <span class="link-ext"></span>
                            <span class="txt">About Us</span>
                          </span>
                        </a>
                      </li>

                      <li>
                        <a href="expertise.html">
                          <span class="link-icon"></span>
                          <span class="link-txt">
                            <span class="link-ext"></span>
                            <span class="txt">Our Expertise</span>
                          </span>
                        </a>
                      </li>

                      <li>
                        <a href="projects.html">
                          <span class="link-icon"></span>
                          <span class="link-txt">
                            <span class="link-ext"></span>
                            <span class="txt">Our Work</span>
                          </span>
                        </a>
                      </li>
                      <li>
                        <a href="team.html">
                          <span class="link-icon"></span>
                          <span class="link-txt">
                            <span class="link-ext"></span>
                            <span class="txt">The Team</span>
                          </span>
                        </a>
                      </li>
                      <li>
                        <a href="news_letter.html">
                          <span class="link-icon"></span>
                          <span class="link-txt">
                            <span class="link-ext"></span>
                            <span class="txt">Blog</span>
                          </span>
                        </a>
                      </li>
                    </ul>
                  </div>
                  <div class="header-module">
                    <a
                      href="contact.html"
                      class="btn btn-solid text-uppercase btn-sm round border-thin btn-white font-size-12 text-uppercase ltr-sp-15 px-2"
                    >
                      <span>
                        <span class="btn-txt">Get in Touch</span>
                      </span>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
      <main id="content" class="content">
        <div class="posts-list-view">
          <section
            class="vc_row py-5 titlebar titlebar-md scheme-light text-center bg-center"
            style="background-image: url(./assets/images/hero.jpg)"
          >
            <div class="titlebar-inner">
              <div class="container titlebar-container">
                <div class="row titlebar-container">
                  <div class="titlebar-col col-md-8 col-md-offset-2 text-white">
                    <h1
                      data-fittext="true"
                      data-fittext-options='{ "maxFontSize": 50, "minFontSize": 32 }'
                    >
                      Our Blog
                    </h1>
                    <p class="font-size-20 lh-185 text-fade-white-07 px-md-7">
                      Stay up-to-date with the latest news, insights, and
                      analysis from our team of experts.
                    </p>
                    <a
                      class="titlebar-scroll-link"
                      href="#posts-section"
                      data-localscroll="true"
                    >
                      <i class="fa fa-angle-down"></i>
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section id="posts-section" class="vc_row pt-100 pb-20">
            <div class="container-fluid mx-md-9">
              <div id="loader-container"></div>
              <div id="posts-container" class="row" style="display: none"></div>
            </div>
          </section>
        </div>

        <div class="single-post-view"></div>
      </main>
      <footer class="main-footer bg-primary" data-sticky-footer="true">
        <section>
          <div class="container">
            <div class="row">
              <div class="lqd-column col-md-8 text-center col-md-offset-2">
                <h3 class="widget-title text-white">
                  Hecta Consulting Limited
                </h3>
                <p class="ld_sf_paragraph pr-2">
                  E.
                  <a
                    href="/cdn-cgi/l/email-protection"
                    class="__cf_email__"
                    data-cfemail="4b22252d240b232e283f2a282425383e273f22252c65282426"
                    >[email&#160;protected]</a
                  >
                  <br />
                  T. (254) 20 2001239
                </p>
                <p class="ld_sf_paragraph pr-2">
                  Tropical Towers, Suite B6,
                  <br />
                  Komo Lane off Wood Avenue, Kilimani, Nairobi
                </p>
              </div>
            </div>
          </div>
        </section>

        <section class="bt-fade-white-015 pt-35 pb-35 mt-50">
          <div class="container">
            <div class="row">
              <div class="lqd-column col-md-6">
                <ul class="lqd-custom-menu reset-ul inline-nav">
                  <li><a href="about.html">About Us</a></li>
                  <li><a href="expertise.html">Our Expertise</a></li>
                  <li><a href="work.html">Our Work</a></li>
                  <li><a href="contact.html">Contact Us</a></li>
                </ul>
              </div>
              <div class="lqd-column col-md-6 text-md-right">
                <p class="my-0">
                  <span style="font-size: 15px"
                    >© 2020 Hecta Consulting Limited. Made with love.</span
                  >
                </p>
              </div>
            </div>
          </div>
        </section>
      </footer>
    </div>

    <script src="./assets/vendors/jquery.min.js"></script>
    <script src="./assets/js/theme-vendors.js"></script>
    <script src="./assets/js/theme.min.js"></script>

    <script>
      let allPosts = [];
      const apiBaseUrl = "https://hecta-pi.vercel.app";

      const postsContainer = document.getElementById("posts-container");
      const loaderContainer = document.getElementById("loader-container");
      const singlePostContainer = document.querySelector(".single-post-view");
      const body = document.body;

      // --- Functions for Loading State ---
      function showLoader() {
        let loaderHTML = '<div class="row">';
        // Create 6 skeleton cards to fill the view
        for (let i = 0; i < 6; i++) {
          loaderHTML += `
                <div class="lqd-column col-md-6 mb-4">
                    <div class="skeleton-card" style="height: 280px;">
                        <div class="skeleton-line date"></div>
                        <div class="skeleton-line title"></div>
                        <div class="skeleton-line text"></div>
                        <div class="skeleton-line text"></div>
                        <div class="skeleton-line text-short"></div>
                        <div class="skeleton-line button"></div>
                    </div>
                </div>
            `;
        }
        loaderHTML += "</div>";
        postsContainer.style.display = "none";
        loaderContainer.innerHTML = loaderHTML;
        loaderContainer.style.display = "block";
      }

      function hideLoader() {
        loaderContainer.style.display = "none";
        postsContainer.style.display = "flex";
      }

      // --- Rich Text Renderer ---
      function renderPayloadRichText(richTextData) {
        if (!richTextData?.root?.children) {
          return "";
        }
        function serialize(nodes) {
          if (!Array.isArray(nodes)) return "";
          return nodes
            .map((node) => {
              if (node.type === "text") {
                let text = node.text || "";
                if (node.format & 1) text = `<strong>${text}</strong>`;
                if (node.format & 2) text = `<em>${text}</em>`;
                if (node.format & 8) text = `<code>${text}</code>`;
                return text;
              }
              if (node.type === "upload") {
                if (node.value?.url) {
                  const fullUrl = node.value.url;
                  const altText = node.value.alt || "Blog post image";
                  return `<img src="${fullUrl}" alt="${altText}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 20px 0;">`;
                }
                return "";
              }
              if (!node.children?.length) return "";
              const childrenHtml = serialize(node.children);
              if (node.type === "paragraph" && !childrenHtml.trim()) return "";
              switch (node.type) {
                case "heading":
                  return `<${node.tag || "h2"}>${childrenHtml}</${
                    node.tag || "h2"
                  }>`;
                case "paragraph":
                  return `<p>${childrenHtml}</p>`;
                case "list":
                  return `<${node.tag || "ul"}>${childrenHtml}</${
                    node.tag || "ul"
                  }>`;
                case "listitem":
                  return `<li>${childrenHtml}</li>`;
                case "link":
                  return `<a href="${
                    node.fields?.url || "#"
                  }" target="_blank" rel="noopener noreferrer">${childrenHtml}</a>`;
                case "root":
                  return childrenHtml;
                default:
                  return childrenHtml;
              }
            })
            .filter(Boolean)
            .join("");
        }
        return (
          serialize(richTextData.root.children) ||
          "<p><em>No content available</em></p>"
        );
      }

      // --- View Control Functions ---
      function showListView() {
        body.classList.remove("single-post-visible");
        singlePostContainer.innerHTML = "";
        window.scrollTo(0, 0);
      }

      function showSinglePost(slug) {
        const postIndex = allPosts.findIndex((p) => p.slug === slug);
        if (postIndex === -1) {
          showListView();
          return;
        }
        const post = allPosts[postIndex];
        const contentHtml = renderPayloadRichText(post.content);
        const publishedDate = new Date(post.publishedAt).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "long", day: "numeric" }
        );

        const prevPost = allPosts[postIndex - 1];
        const nextPost = allPosts[postIndex + 1];
        let navHtml = '<div class="post-navigation">';
        navHtml += prevPost
          ? `<a href="#${encodeURIComponent(prevPost.slug)}" class="btn btn-solid btn-secondary text-uppercase btn-sm round border-thin font-size-12 ltr-sp-15 px-2 mt-auto text-white" style="color: white;">‹ Previous Post</a>`
          : "<span></span>";
        navHtml += nextPost
          ? `<a href="#${encodeURIComponent(nextPost.slug)}" class="btn btn-solid btn-secondary text-uppercase btn-sm round border-thin font-size-12 ltr-sp-15 px-2 mt-auto text-white" style="color: white;">Next Post ›</a>`
          : "<span></span>";
        navHtml += "</div>";

        singlePostContainer.innerHTML = `
            <section class="vc_row py-5 titlebar titlebar-md scheme-light text-center bg-center" style="background-image: url(./assets/images/hero.jpg)">
                <div class="titlebar-inner">
                    <div class="container titlebar-container">
                        <div class="row titlebar-container">
                            <div class="titlebar-col col-md-10 col-md-offset-1 text-white">
                                <h1 data-fittext="true" data-fittext-options='{ "maxFontSize": 45, "minFontSize": 30 }'>${post.title}</h1>
                                <p class="font-size-16 text-fade-white-07">Published on ${publishedDate}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="vc_row single-post-content">
                <div class="container">
                    <div class="row">
                        <div class="lqd-column col-md-8 col-md-offset-2">
                            <a href="#" class="btn btn-solid btn-secondary text-uppercase btn-sm round border-thin font-size-12 ltr-sp-15 px-2 mt-auto text-white" style="color: white;">Back to Blog</a>
                            <div class="post-full-content mt-4">${contentHtml}</div>
                            ${navHtml}
                        </div>
                    </div>
                </div>
            </section>
        `;

        body.classList.add("single-post-visible");
        window.scrollTo(0, 0);

        // Add event listener for the "Back to Blog" button
        singlePostContainer
          .querySelector("a[href='#']")
          .addEventListener("click", (e) => {
            e.preventDefault();
            window.location.hash = "";
          });
      }

      // --- Post Element Creation ---
      function createPostElement(post) {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = renderPayloadRichText(post.content);
        const excerpt =
          (tempDiv.textContent || tempDiv.innerText || "").substring(0, 150) +
            "..." || "No preview available";
        const publishedDate = new Date(post.publishedAt).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "long", day: "numeric" }
        );

        const column = document.createElement("div");
        column.className = "lqd-column col-md-6 mb-4";
        column.innerHTML = `
            <div class="card-container" style="height: 100%;">
                <a href="#${encodeURIComponent(post.slug)}" style="text-decoration: none; color: inherit; display: flex; flex-direction: column; height: 100%;">
                    <div class="panel border-none bg-athens-gray border-radius-12 bg-hover-secondary" style="padding: 25px; height: 100%; transition: all 0.3s ease; display: flex; flex-direction: column;">
                        <h4 class="accordion-title font-size-19" style="flex-grow: 1;">
                            <time class="liquid-lp-date text-uppercase size-sm text-fade-dark-04">${publishedDate}</time>
                            ${post.title}
                        </h4>
                        <div class="accordion-content pt-3" style="padding:0; flex-grow: 1;">
                            <p>${excerpt}</p>
                        </div>
                        <span class="btn btn-solid btn-secondary text-uppercase btn-sm round border-thin font-size-12 ltr-sp-15 px-2 mt-auto text-white" style="color: white; align-self: flex-start;">Read More</span>
                    </div>
                </a>
            </div>
        `;
        return column;
      }

      // --- Data Fetching and Rendering ---
      async function fetchAndRenderPosts() {
        showLoader(); // Show loader on initial call
        try {
          const res = await fetch(`${apiBaseUrl}/api/posts`, {
            method: "GET",
            headers: { Authorization: `Bearer b47af2ba8bf707b5c97f6da5` },
          });
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);

          const responseData = await res.json();
          allPosts = Array.isArray(responseData)
            ? responseData
            : responseData.docs || [];
          allPosts.sort(
            (a, b) => new Date(b.publishedAt) - new Date(a.publishedAt)
          ); // Sort by newest first

          postsContainer.innerHTML = "";
          if (allPosts.length === 0) {
            postsContainer.innerHTML = "<p>No posts found.</p>";
          } else {
            const row = document.createElement("div");
            row.className = "row";
            allPosts.forEach((post) => {
              row.appendChild(createPostElement(post));
            });
            postsContainer.appendChild(row);
          }
        } catch (error) {
          console.error("Error fetching posts:", error);
          postsContainer.innerHTML =
            '<p class="text-danger">Sorry, we could not load blog posts.</p>';
        } finally {
          // View logic is now handled by handleHashChange, which is called after this.
          handleHashChange();
        }
      }

      // --- URL Hash/Routing Logic ---
      function handleHashChange() {
        const slug = decodeURIComponent(window.location.hash.substring(1));
        if (slug && allPosts.length > 0) {
          loaderContainer.style.display = "none";
          showSinglePost(slug);
        } else {
          hideLoader();
          showListView();
        }
      }

      window.addEventListener("hashchange", handleHashChange);
      document.addEventListener("DOMContentLoaded", fetchAndRenderPosts);
    </script>
  <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"54a81ff06a884d41a3fa15b0db774346","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
